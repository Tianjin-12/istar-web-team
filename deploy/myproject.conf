[group:myproject]
programs=gunicorn,celery-worker,celery-beat,flower,health-monitor

[program:gunicorn]
command=/var/www/myproject/venv/bin/gunicorn --bind 127.0.0.1:8000 --workers 2 --threads 4 --timeout 120 myproject.wsgi:application
directory=/var/www/myproject
user=www-data
numprocs=1
autostart=true
autorestart=true
startsecs=10
stopwaitsecs=60
exitcodes=0,1
environment=PATH="/var/www/myproject/venv/bin",DJANGO_SETTINGS_MODULE="myproject.settings"
stdout_logfile=/var/log/gunicorn/myproject.log
stderr_logfile=/var/log/gunicorn/myproject.err

[program:celery-worker]
command=/var/www/myproject/venv/bin/celery -A myproject worker -l info --hostname=worker@%%h
directory=/var/www/myproject
user=www-data
numprocs=5
process_name=%(program_name)s_%(process_num)02d
autostart=true
autorestart=true
startsecs=10
stopwaitsecs=60
exitcodes=0,1
environment=PATH="/var/www/myproject/venv/bin",DJANGO_SETTINGS_MODULE="myproject.settings",CELERY_BROKER_URL="redis://localhost:6380/0",CELERY_RESULT_BACKEND="redis://localhost:6380/1",TIME_ZONE="Asia/Shanghai"
stdout_logfile=/var/log/celery/worker.log
stderr_logfile=/var/log/celery/worker.err

[program:celery-beat]
command=/var/www/myproject/venv/bin/celery -A myproject beat -l info
directory=/var/www/myproject
user=www-data
numprocs=1
autostart=true
autorestart=true
startsecs=10
stopwaitsecs=60
environment=PATH="/var/www/myproject/venv/bin",DJANGO_SETTINGS_MODULE="myproject.settings",CELERY_BROKER_URL="redis://localhost:6380/0",CELERY_RESULT_BACKEND="redis://localhost:6380/1",TIME_ZONE="Asia/Shanghai"
stdout_logfile=/var/log/celery/beat.log
stderr_logfile=/var/log/celery/beat.err

[program:flower]
command=/var/www/myproject/venv/bin/celery -A myproject --broker=redis://localhost:6380/0 flower --port=5555
directory=/var/www/myproject
user=www-data
numprocs=1
autostart=true
autorestart=true
startsecs=10
stopwaitsecs=60
environment=PATH="/var/www/myproject/venv/bin"
stdout_logfile=/var/log/flower/flower.log
stderr_logfile=/var/log/flower/flower.err

[program:health-monitor]
command=/bin/bash /var/www/myproject/scripts/health_monitor.sh
directory=/var/www/myproject
user=www-data
numprocs=1
autostart=true
autorestart=true
startsecs=10
stopwaitsecs=60
stdout_logfile=/var/log/health-monitor/monitor.log
stderr_logfile=/var/log/health-monitor/monitor.err
